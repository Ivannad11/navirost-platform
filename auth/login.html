<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Вход — навырост.</title>
    <link rel="stylesheet" href="../assets/css/styles.css">
</head>
<body>
    <div class="auth-container">
        <div class="auth-card">
            <h1 class="auth-title">С возвращением</h1>
            <p class="auth-subtitle">Войдите, чтобы управлять проектами</p>
            
            <form>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" class="form-input" required placeholder="name@company.com">
                </div>
                <div class="form-group">
                    <label>Пароль</label>
                    <input type="password" class="form-input" required placeholder="••••••••">
                </div>
                <button type="submit" class="btn-primary w-100">Войти</button>
            </form>
            
            <div class="auth-footer">
                Нет аккаунта? <a href="./register.html">Зарегистрироваться</a>
            </div>
        </div>
    </div>

    <script>
    (function() {
      'use strict';
      
      // Проверка поддержки localStorage
      function isLocalStorageAvailable() {
        try {
          const test = '__test__';
          localStorage.setItem(test, test);
          localStorage.removeItem(test);
          return true;
        } catch (e) {
          return false;
        }
      }
      
      const form = document.querySelector('form');
      if (!form) return;
      
      form.addEventListener('submit', function(e) {
        e.preventDefault();
        e.stopPropagation();
        
        const emailInput = document.querySelector('input[type="email"]');
        const passwordInput = document.querySelector('input[type="password"]');
        
        if (!emailInput || !passwordInput) {
          console.error('Форма не найдена');
          return;
        }
        
        const email = emailInput.value.trim();
        const password = passwordInput.value.trim();
        
        console.log('Login attempt:', { email: email ? 'yes' : 'no', password: password ? 'yes' : 'no' });
        
        if (!email || !password) {
          // Вместо alert используем текстовое сообщение
          let errorMsg = document.getElementById('error-message');
          if (!errorMsg) {
            errorMsg = document.createElement('div');
            errorMsg.id = 'error-message';
            errorMsg.style.color = 'red';
            errorMsg.style.marginTop = '10px';
            errorMsg.style.textAlign = 'center';
            form.appendChild(errorMsg);
          }
          errorMsg.innerText = 'Пожалуйста, заполните все поля';
          return;
        }
        
        // Проверка localStorage
        if (isLocalStorageAvailable()) {
          try {
            localStorage.setItem('userEmail', email);
            localStorage.setItem('isLoggedIn', 'true');
            console.log('localStorage saved');
          } catch (e) {
            console.error('localStorage error:', e);
          }
        } else {
          console.warn('localStorage недоступен (Private Mode?)');
        }
        
        // Редирект с использованием абсолютного пути
        const currentPath = window.location.pathname;
        const basePath = currentPath.includes('/navirost-platform/') 
          ? '/navirost-platform' 
          : '';
        
        const targetUrl = basePath + '/platform/home.html';
        
        console.log('Redirecting to:', targetUrl);
        
        // Используем replace вместо href (чтобы не добавлять в историю)
        window.location.replace(targetUrl);
        
        // Fallback через setTimeout (на случай если replace не сработал)
        setTimeout(function() {
          window.location.href = targetUrl;
        }, 100);
      });
    })();
    </script>
</body>
</html>
